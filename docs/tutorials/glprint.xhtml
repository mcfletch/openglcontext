<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
<title>NeHe Translations: Win32 Bitmap Text (NeHe 13)</title>
    <link href="./tutorial.css" type="text/css" rel="stylesheet" />
</head>
<body>
<table width="100%" class="navtable"><thead>
	<tr>
		<td width="8em;"></td><th align="center"><a href="index.xhtml">OpenGLContext Python tutorials</a></th><td width="8em;"></td>
	</tr>
	<tr>
	<td><a href="nehe6_multi.xhtml">Previous</a></td>
	<td align="center">NeHe Translations: Win32 Bitmap Text (NeHe 13)</td>
	<td align="right"><a href="index.xhtml">Index</a></td>
	</tr>
</thead></table>
	<div class="code-sample">#! /usr/bin/env python
</div>
	<div class="commentary">
	<h1 class="title">Win32 Bitmap Text (NeHe 13)</h1>
	<div class="paragraph">This tutorial draws text to screen using WGL bitmap functionality
WGL is only available on Win32 platforms!</div>
	<div class="paragraph">This tutorial is based on the 
	<a href="http://nehe.gamedev.net/data/lessons/lesson.asp?lesson=13" class="">NeHe13 tutorial</a>
	 by Jeff Molofee and assumes that you are reading along 
with the tutorial, so that only changes from the tutorial are noted 
here.
</div>
	<div class="paragraph">We're going to have to use the wxPython context explicitly, so that 
we have a single API for getting a window handle.
</div>
</div>
	<div class="code-sample">from OpenGLContext.wxinteractivecontext import wxInteractiveContext
from OpenGL.GL import *
from math import cos, sin
import sys
try:
	from OpenGL.WGL import *
	import win32ui, win32con
except ImportError, err:
	raise ImportError( """Unable to import Win32 text modules: %s"""%(err,))
</div>
	<div class="commentary">
	<div class="paragraph">Our "font" class takes care of creating the display-lists 
which perform the actual rendering of characters.  The Win32ui 
calls are loosely the same as those seen in the tutorial.</div>
</div>
	<div class="code-sample">class font:
	def __init__(self, context):
		self.base = glGenLists(96)								# Storage For 96 Characters
		wgldc = wglGetCurrentDC()
		if wgldc > sys.maxint:
			import struct
			print 'too-large wgldc', wgldc
			wgldc = struct.unpack( '>i', struct.pack( '>I', wgldc ))[0]
			print 'Converted wgldc to', wgldc
		dc = win32ui.CreateDCFromHandle( wgldc )
		## pitch and family value
		f = win32ui.CreateFont(
			{
				'italic': None, #use of None is required, 0 doesn't work
				'underline': None, #use of None is required, 0 doesn't work
				'name': 'Times New Roman',
				'weight': 700,
				'height': 20,
			}
		)
		dc.SelectObject(
			f
		)
</div>
	<div class="commentary">
	<div class="paragraph">Build 96 bitmaps as display lists starting from character 
		32.</div>
</div>
	<div class="code-sample">		wglUseFontBitmaps(wgldc, 32, 96, self.base)
</div>
	<div class="commentary">
	<div class="paragraph">f is deleted here, if it is deleted before the display-lists
		are created they will just use the default font!</div>
</div>
	<div class="code-sample">	def __del__(self):
		glDeleteLists(self.base, 96)	# Delete All 96 Characters
	def draw(self, text):
</div>
	<div class="commentary">
	<div class="paragraph">glCallLists is pretty much tailor-made for these kinds of 
		calls, a single GL call can render an entire string of text.
		Note, however, that glCallLists is now deprecated.</div>
</div>
	<div class="code-sample">		glCallLists(
			map(
				lambda x, y: ord(x) - 32 + y, 
				text, 
				[self.base]*len(text)
			)
		)
</div>
	<div class="commentary">
	<div class="paragraph">The timer class here is a trivial wrapping of the wxPython timer 
class.  Real-world OpenGLContext code would likely use the Timer 
class instance.</div>
</div>
	<div class="code-sample">import wx
class timer(wx.Timer):
	def __init__(self, parent):
		wx.Timer.__init__(self)
		self.parent = parent
	def Notify(self):
		if self.parent:
			self.parent.cnt1+=0.051
			self.parent.cnt2+=0.005
</div>
	<div class="commentary">
	<div class="paragraph">Trigger a redraw using wxPython operation</div>
</div>
	<div class="code-sample">			self.parent.Refresh()
		else:
			self.Stop()
class TestContext( wxInteractiveContext ):
##	rot = 0
	cnt1 = 0
	cnt2 = 0
	def __init__(self, parent):
		wxInteractiveContext.__init__(self, parent)
		# TODO: this font *shouldn't* be needed...
		f = wx.Font(
			20,
			wx.DECORATIVE,
			wx.NORMAL,
			wx.NORMAL,
			0,
			"Script",
		)
		self.SetFont( f )
		self.my_font = font( self )
		self.timer = None
	def Render( self, mode):
		wxInteractiveContext.Render( self, mode )
		glDisable(GL_LIGHTING)
		glRasterPos2f(5*cos(self.cnt1), 5*sin(self.cnt2))
		self.my_font.draw("NeHe - %3.2f" % self.cnt1)
		if self.timer is None:
			self.timer = timer(self)
			self.timer.Start(25)
	def Background(self, mode = 0):
		"""Clear to Blue"""
		glClearColor(0.0,0.0,1.0,1.0)
		glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT )
if __name__ == "__main__":
	import wx
	class MyApp(wx.App):
		def OnInit(self):
			frame = wx.Frame(
				None, -1, "NeHe GL Text Demo",
				wx.DefaultPosition, wx.Size(600,300),
			)
			self.SetTopWindow(frame)
			frame.Show( True )
			win = TestContext(frame)
			return True
	app = MyApp(0)
	app.MainLoop()
</div>
	<div class="commentary">
	<div class="paragraph">
Author: 
	<a href="http://nehe.gamedev.net" class="">Jeff Molofee (aka NeHe)</a>
</div>
	<div class="paragraph">COPYRIGHT AND DISCLAIMER: (c)2000 Jeff Molofee</div>
	<div class="paragraph">If you plan to put this program on your web page or a cdrom of
any sort, let me know via email, I'm curious to see where
it ends up :)</div>
	<div class="paragraph">If you use the code for your own projects please give me
credit, or mention my web site somewhere in your program 
or it's docs.
</div>
</div>
<table width="100%" class="navtable"><thead>
	<tr>
		<td width="8em;"></td><th align="center"><a href="index.xhtml">OpenGLContext Python tutorials</a></th><td width="8em;"></td>
	</tr>
	<tr>
	<td><a href="nehe6_multi.xhtml">Previous</a></td>
	<td align="center">NeHe Translations: Win32 Bitmap Text (NeHe 13)</td>
	<td align="right"><a href="index.xhtml">Index</a></td>
	</tr>
</thead></table>
</body>
</html>